<Window x:Class="GymManager.App.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        mc:Ignorable="d"
        Title="GYM力量健身管理系统"
        Height="900"
        Width="1400"
        MinHeight="720"
        MinWidth="1200">
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="240" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <!-- Side Navigation -->
        <Border Grid.RowSpan="2"
                Grid.Column="0"
                Background="{StaticResource Gym.BlackBrush}"
                TextElement.Foreground="White">
            <StackPanel Margin="16">
                <TextBlock Text="GYM力量"
                           Foreground="White"
                           FontSize="22"
                           FontWeight="Bold" />
                <TextBlock Text="管理者端"
                           Foreground="#CCFFFFFF"
                           Margin="0,2,0,16" />

                <Button Command="{Binding NavigateDashboardCommand}"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        HorizontalContentAlignment="Left"
                        Foreground="White"
                        Margin="0,4">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="ViewDashboard" Width="18" Height="18" Margin="0,0,8,0" Foreground="White" />
                        <TextBlock Text="首页仪表盘" />
                    </StackPanel>
                </Button>

                <Button Command="{Binding NavigateCoachesCommand}"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        HorizontalContentAlignment="Left"
                        Foreground="White"
                        Margin="0,4">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AccountTie" Width="18" Height="18" Margin="0,0,8,0" Foreground="White" />
                        <TextBlock Text="教练管理" />
                    </StackPanel>
                </Button>

                <Button Command="{Binding NavigatePrivateTrainingMembersCommand}"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        HorizontalContentAlignment="Left"
                        Foreground="White"
                        Margin="0,4">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AccountGroup" Width="18" Height="18" Margin="0,0,8,0" Foreground="White" />
                        <TextBlock Text="私教课会员" />
                    </StackPanel>
                </Button>

                <Button Command="{Binding NavigateAnnualCardMembersCommand}"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        HorizontalContentAlignment="Left"
                        Foreground="White"
                        Margin="0,4">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="CalendarClock" Width="18" Height="18" Margin="0,0,8,0" Foreground="White" />
                        <TextBlock Text="年卡会员" />
                    </StackPanel>
                </Button>

                <Border Margin="0,16,0,0" Height="1" Background="#33FFFFFF" />

                <TextBlock Text="提示：到期提醒将在首页显示"
                           Foreground="#AAFFFFFF"
                           Margin="0,12,0,0"
                           TextWrapping="Wrap" />
            </StackPanel>
        </Border>

        <!-- Top Header / Mini Dashboard -->
        <Border Grid.Row="0"
                Grid.Column="1"
                Background="{StaticResource Gym.DarkBrush}"
                BorderBrush="{StaticResource Gym.BorderBrush}"
                BorderThickness="0,0,0,1"
                Padding="16,12">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <DockPanel Grid.Row="0" LastChildFill="True">
                    <StackPanel DockPanel.Dock="Left">
                        <TextBlock Text="GYM力量健身管理系统"
                                   FontSize="18"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="{Binding Now, StringFormat={}{0:yyyy-MM-dd HH:mm:ss}}"
                                   Opacity="0.8" />
                    </StackPanel>

                    <!-- 顶部仪表盘摘要 -->
                    <WrapPanel DockPanel.Dock="Right" HorizontalAlignment="Right" VerticalAlignment="Center">
                        <materialDesign:Chip Content="{Binding Dashboard.CoachCount, StringFormat=教练 {0}}"
                                             Margin="0,0,8,0" />
                        <materialDesign:Chip Content="{Binding Dashboard.PrivateTrainingMemberCount, StringFormat=私教课 {0}}"
                                             Margin="0,0,8,0" />
                        <materialDesign:Chip Content="{Binding Dashboard.AnnualCardMemberCount, StringFormat=年卡 {0}}"
                                             Margin="0,0,8,0" />
                        <materialDesign:Chip Content="{Binding Dashboard.AnnualCardExpiringCount, StringFormat=到期 {0}}"
                                             Background="{StaticResource Gym.OrangeBrush}"
                                             Foreground="Black"
                                             Margin="0,0,8,0" />
                        <materialDesign:Chip Content="{Binding Dashboard.LowRemainingSessionsCount, StringFormat=剩余不足 {0}}"
                                             Margin="0,0,0,0" />
                    </WrapPanel>
                </DockPanel>

                <!-- 到期提醒横幅：醒目但不阻断操作 -->
                <Button Grid.Row="1"
                        Command="{Binding GoToExpiringAnnualCardsCommand}"
                        Visibility="{Binding Dashboard.AnnualCardExpiringCount, Converter={StaticResource IntGt0ToVis}}"
                        Margin="0,10,0,0"
                        Background="{StaticResource Gym.OrangeBrush}"
                        Foreground="Black"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        HorizontalContentAlignment="Left"
                        Padding="12,8">
                    <StackPanel Orientation="Horizontal">
                        <materialDesign:PackIcon Kind="AlertCircleOutline" Width="18" Height="18" Margin="0,0,8,0" />
                        <TextBlock Text="{Binding Dashboard.ExpiringAnnualCards, Converter={StaticResource AnnualCardReminderText}}"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="{Binding Dashboard.AnnualCardExpiringCount, StringFormat=  共 {0} 人即将到期（点击查看）}"
                                   Margin="8,0,0,0" />
                    </StackPanel>
                </Button>
            </Grid>
        </Border>

        <!-- Content -->
        <ContentControl Grid.Row="1"
                        Grid.Column="1"
                        Content="{Binding CurrentPage}" />

        <!-- Global Snackbar -->
        <materialDesign:Snackbar Grid.Row="1"
                                 Grid.Column="1"
                                 MessageQueue="{Binding SnackbarQueue}"
                                 HorizontalAlignment="Right"
                                 VerticalAlignment="Bottom"
                                 Margin="16" />
    </Grid>
</Window>
