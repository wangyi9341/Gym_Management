<UserControl x:Class="GymManager.App.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             mc:Ignorable="d">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="16" Orientation="Vertical">
            <DockPanel Margin="0,0,0,12">
                <TextBlock Text="首页仪表盘"
                           FontSize="22"
                           FontWeight="SemiBold"
                           DockPanel.Dock="Left" />

                <StackPanel DockPanel.Dock="Right" Orientation="Horizontal">
                    <Button Content="刷新"
                            Command="{Binding RefreshCommand}"
                            Style="{StaticResource MaterialDesignFlatButton}"
                            Margin="0,0,8,0" />
                    <ProgressBar Width="160"
                                 Height="4"
                                 Margin="0,14,0,0"
                                 IsIndeterminate="True"
                                 Visibility="{Binding IsLoading, Converter={StaticResource BoolToVis}}" />
                </StackPanel>
            </DockPanel>

            <UniformGrid Columns="6">
                <materialDesign:Card Margin="8" Padding="12">
                    <StackPanel>
                        <TextBlock Text="教练总数" Opacity="0.8"/>
                        <TextBlock Text="{Binding CoachCount}" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </materialDesign:Card>
                <materialDesign:Card Margin="8" Padding="12">
                    <StackPanel>
                        <TextBlock Text="私教课会员" Opacity="0.8"/>
                        <TextBlock Text="{Binding PrivateTrainingMemberCount}" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </materialDesign:Card>
                <materialDesign:Card Margin="8" Padding="12">
                    <StackPanel>
                        <TextBlock Text="年卡会员" Opacity="0.8"/>
                        <TextBlock Text="{Binding AnnualCardMemberCount}" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </materialDesign:Card>
                <materialDesign:Card Margin="8" Padding="12">
                    <StackPanel>
                        <TextBlock Text="即将到期" Opacity="0.8"/>
                        <TextBlock Text="{Binding AnnualCardExpiringCount}" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </materialDesign:Card>
                <materialDesign:Card Margin="8" Padding="12">
                    <StackPanel>
                        <TextBlock Text="已过期" Opacity="0.8"/>
                        <TextBlock Text="{Binding AnnualCardExpiredCount}" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </materialDesign:Card>
                <materialDesign:Card Margin="8" Padding="12">
                    <StackPanel>
                        <TextBlock Text="剩余不足" Opacity="0.8"/>
                        <TextBlock Text="{Binding LowRemainingSessionsCount}" FontSize="24" FontWeight="Bold"/>
                    </StackPanel>
                </materialDesign:Card>
            </UniformGrid>

            <Grid Margin="8,12,8,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <materialDesign:Card Grid.Column="0" Padding="12" Margin="0,0,12,0">
                    <StackPanel>
                        <TextBlock Text="{Binding AnnualCardExpiringDays, StringFormat=年卡到期提醒（未来 {0} 天内）}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <DataGrid ItemsSource="{Binding ExpiringAnnualCards}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="姓名" Binding="{Binding Name}" Width="120" />
                                <DataGridTextColumn Header="电话" Binding="{Binding Phone}" Width="140" />
                                <DataGridTextColumn Header="截止" Binding="{Binding EndDate, StringFormat={}{0:yyyy-MM-dd}}" Width="120" />
                                <DataGridTextColumn Header="剩余天数" Binding="{Binding DaysToExpire}" Width="100" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </materialDesign:Card>

                <materialDesign:Card Grid.Column="1" Padding="12">
                    <StackPanel>
                        <TextBlock Text="{Binding LowRemainingThreshold, StringFormat=私教课剩余课程不足（≤ {0}）}"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,8"/>
                        <DataGrid ItemsSource="{Binding LowRemainingSessionsMembers}">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="姓名" Binding="{Binding Name}" Width="120" />
                                <DataGridTextColumn Header="电话" Binding="{Binding Phone}" Width="140" />
                                <DataGridTextColumn Header="总课程" Binding="{Binding TotalSessions}" Width="90" />
                                <DataGridTextColumn Header="已用" Binding="{Binding UsedSessions}" Width="70" />
                                <DataGridTextColumn Header="剩余" Binding="{Binding RemainingSessions}" Width="70" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </materialDesign:Card>
            </Grid>
        </StackPanel>
    </ScrollViewer>
</UserControl>
